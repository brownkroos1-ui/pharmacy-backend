name: Backend CI

on:
  push:
    branches: ["main", "master"]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      JWT_SECRET: "ci-test-secret-ci-test-secret-ci-test-secret"
      ADMIN_BOOTSTRAP_PASSWORD: "ci-admin-password"
      ADMIN_BOOTSTRAP_SECRET: "ci-bootstrap-secret"
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
          cache: "maven"

      - name: Make mvnw executable
        run: chmod +x mvnw

      - name: Run tests
        run: bash ./mvnw -B -Dtest=AuthControllerTest,AuthControllerRefreshTest,AdminDashboardServiceTest test

  build:
    runs-on: ubuntu-latest
    env:
      JWT_SECRET: "ci-test-secret-ci-test-secret-ci-test-secret"
      ADMIN_BOOTSTRAP_PASSWORD: "ci-admin-password"
      ADMIN_BOOTSTRAP_SECRET: "ci-bootstrap-secret"
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
          cache: "maven"

      - name: Make mvnw executable
        run: chmod +x mvnw

      - name: Build (skip tests)
        run: bash ./mvnw -B -DskipTests package
